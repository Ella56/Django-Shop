{% extends "base.html" %}
{% load static %}
{% load humanize %}
{% load jalali_filters %}
{% block 'title' %}Products{% endblock 'title' %}

{% block 'content' %}
<section class="inner-page" id="products-page">
    <div class="container-fluid" id="page-hero">
        <div class="row">
            <div class="col-12">
                <div class="container">
                    <div class="row">
                        <div class="col-12 px-0">
                            <h1>ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø±ÙˆØ¨ÛŒÚ© Ù…Ø§Ø±Ú©Øª</h1>
                            <p>Ù‡Ø± Ø¢Ù†Ú†Ù‡ Ù†ÛŒØ§Ø² Ø¯Ø§Ø±ÛŒØ¯ Ø¯Ø± Ø§ÛŒÙ† ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³Øª</p>
                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="{% url 'root:home' %}">ØµÙØ­Ù‡ Ù†Ø®Ø³Øª</a></li>
                                    <li class="breadcrumb-item active" aria-current="page">Ù…Ø­ØµÙˆÙ„Ø§Øª</li>
                                </ol>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container mt-3">
        <!-- ğŸ” Search Bar -->
        <div class="row mb-4">
            <div class="col-md-6 mx-auto">
                <input type="text" id="searchInput" class="form-control text-center" placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ Ù…Ø­ØµÙˆÙ„...">
            </div>
        </div>

        <div class="row">
            <!-- Sidebar -->
            <div class="col-lg-3">
                <!-- (Your accordion filters remain exactly as you had them) -->
                <!-- ... -->
            </div>

            <!-- ğŸ”§ Dynamic Product Section -->
            <div class="col-lg-9">
                <div id="product-list" class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 gx-md-4">
                    <!-- JS will insert products here -->
                </div>

                <!-- Pagination -->
                <div class="text-center mt-4">
                    <button id="prevBtn" class="btn btn-outline-secondary btn-sm mx-1">Ù‚Ø¨Ù„ÛŒ</button>
                    <button id="nextBtn" class="btn btn-outline-secondary btn-sm mx-1">Ø¨Ø¹Ø¯ÛŒ</button>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock 'content' %}

{% block 'scripts' %}
<script>



    document.addEventListener("DOMContentLoaded", () => {
        const productList = document.getElementById("product-list");
        const searchInput = document.getElementById("searchInput");
        const nextBtn = document.getElementById("nextBtn");
        const prevBtn = document.getElementById("prevBtn");
        let currentPage = 1;
        let currentSearch = "";

        async function fetchProducts(page = 1, search = "") {
            try {
                const response = await fetch(`http://127.0.0.1:8000/products/api/v1/products?page=${page}&search=${search}`);
;
                const data = await response.json();
                productList.innerHTML = "";

                if (data.results && data.results.length > 0) {
                    data.results.forEach(product => {
                        const item = document.createElement("div");
                        item.classList.add("col");
                        item.innerHTML = `
                            <div class="product-box">
                                <a href="/products/product-detail/${product.id}">
                                    <div class="image" style="background-image: url('${product.img1}');"></div>
                                
                                <div class="details p-3">
                                    <h2>${product.name}</h2>
                                    <p>${product.price.toLocaleString()} ØªÙˆÙ…Ø§Ù†</p>
                                </div>
                                </a>
                            </div>
                        `;
                        productList.appendChild(item);
                    });
                } else {
                    productList.innerHTML = "<p class='text-center w-100'>Ù…Ø­ØµÙˆÙ„ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</p>";
                }

                // Update pagination buttons
                nextBtn.disabled = !data.next;
                prevBtn.disabled = !data.previous;

            } catch (error) {
                console.error("Error loading products:", error);
                alert("Error: " + error.message);
                productList.innerHTML = "<p class='text-danger text-center w-100'>Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª</p>";
            }
        }

        // Event listeners
        searchInput.addEventListener("input", e => {
            currentSearch = e.target.value;
            currentPage = 1;
            fetchProducts(currentPage, currentSearch);
        });

        nextBtn.addEventListener("click", () => {
            currentPage++;
            fetchProducts(currentPage, currentSearch);
        });

        prevBtn.addEventListener("click", () => {
            if (currentPage > 1) {
                currentPage--;
                fetchProducts(currentPage, currentSearch);
            }
        });

        // Initial load
        fetchProducts();
    });
</script>
{% endblock 'scripts' %}
